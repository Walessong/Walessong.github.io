(()=>{document.addEventListener("DOMContentLoaded",function(){let d=document.getElementById("toc-container"),s=document.getElementById("toc-nav"),i=document.getElementById("toc-toggle"),h=document.getElementById("toc-progress-bar"),a=document.getElementById("toc-expand"),g=document.getElementById("toc-backtop"),m=document.getElementById("toc-header");if(!d)return;let p=()=>{window.scrollY>24?m.classList.add("is-stuck"):m.classList.remove("is-stuck")};p(),window.addEventListener("scroll",p,{passive:!0}),i&&i.addEventListener("click",function(){s.classList.toggle("show");let t=this.querySelector("svg");s.classList.contains("show")?t.innerHTML='<path d="M6 18L18 6M6 6l12 12"/>':t.innerHTML='<path d="M3 12h18M3 6h18M3 18h18"/>'});let c=d.querySelector(".toc-content nav, .toc-content > nav");c&&(c.querySelectorAll("li a").forEach(t=>{let o=t.textContent||""}),c.querySelectorAll("ul ul ul").forEach(t=>{t.style.display="none",t.classList.add("is-collapsed")}));let l=!1;a&&a.addEventListener("click",()=>{l=!l,a.textContent=l?"\u6298\u53E0":"\u5C55\u5F00\u5168\u90E8",c&&c.querySelectorAll("ul ul ul").forEach(t=>{t.style.display=l?"block":"none"})}),g&&g.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})});let v=document.querySelectorAll("h1, h2, h3, h4"),u=d.querySelectorAll("nav a");if(v.length===0||u.length===0)return;function E(){let t=window.pageYOffset||document.documentElement.scrollTop,o=window.innerHeight,e=null,r=0;v.forEach(n=>{let w=n.getBoundingClientRect().top+t;t>=w-120&&(e=n,r=Math.min(100,(t-w+120)/(o*.8)*100))}),u.forEach(n=>{n.classList.remove("active"),e&&n.getAttribute("href")==="#"+e.id&&n.classList.add("active")}),h&&(h.style.width=r+"%")}function L(t){let o=document.getElementById(t);if(o){let e=o.offsetTop-90;window.scrollTo({top:e,behavior:"smooth"})}}u.forEach(t=>{t.addEventListener("click",function(o){let e=this.getAttribute("href");if(e&&e.startsWith("#")&&(o.preventDefault(),L(e.substring(1)),window.innerWidth<=900&&s.classList.contains("show")&&(s.classList.remove("show"),i))){let r=i.querySelector("svg");r.innerHTML='<path d="M3 12h18M3 6h18M3 18h18"/>'}})});let f=!1;function y(){f||(requestAnimationFrame(()=>{E(),f=!1}),f=!0)}window.addEventListener("scroll",y,{passive:!0}),E()});})();
